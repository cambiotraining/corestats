{
  "hash": "ce5a693deaf612f1d3d3ef939a864a25",
  "result": {
    "markdown": "---\ntitle: \"Two-way ANOVA\"\n---\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n:::\n\n\n::: callout-tip\n## Learning outcomes\n\n**Questions**\n\n- When is the use of a two-way ANOVA appropriate?\n- How do I perform this in R?\n\n**Objectives**\n\n- Be able to perform a two-way ANOVA in R\n- Understand the concept of interaction between two predictor variables\n- Be able to plot interactions in R\n:::\n\n## Libraries and functions\n\n::: {.callout-note collapse=\"true\"}\n## Click to expand\n\n::: {.panel-tabset group=\"language\"}\n## tidyverse\n\n### Libraries\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# A collection of R packages designed for data science\nlibrary(tidyverse)\n\n# Converts stats functions to a tidyverse-friendly format\nlibrary(rstatix)\n\n# Creates diagnostic plots using ggplot2\nlibrary(ggResidpanel)\n```\n:::\n\n\n### Functions\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Creates diagnostic plots\nggResidpanel::resid_panel()\n```\n:::\n\n\n## R\n\n## Python\n:::\n:::\n\n## Purpose and aim\n\nA two-way analysis of variance is used when we have two categorical predictor variables (or factors) and a single continuous response variable. For example, when we are looking at how body `weight` (continuous response variable in kilograms) is affected by sex (categorical variable, `Male` or `Female`) and `exercise` type (categorical variable, `Control` or `Runner`).\n\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![](cs4_practical_two-way-anova_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n\nWhen analysing these type of data there are two things we want to know:\n\n1.\tDoes either of the predictor variables have an effect on the response variable i.e. does sex affect body weight? Or does being a runner affect body weight?\n2.\tIs there any **interaction** between the two predictor variables? An interaction would mean that the effect that exercise has on your weight depends on whether you are male or female rather than being independent of your sex. For example if being male means that runners weigh more than non-runners, but being female means that runners weight less than non-runners then we would say that there was an interaction.\n\nWe will first consider how to visualise the data before then carrying out an appropriate statistical test.\n\n## Data and hypotheses\n\nWe will recreate the example analysis used in the lecture. The data are stored as a `.csv` file called `data/CS4-exercise.csv`.\n\n## Summarise and visualise\n`exercise` is a data frame with three variables; `weight`, `sex` and `exercise.` `weight` is the continuous response variable, whereas `sex` and `exercise` are the categorical predictor variables.\n\n::: {.panel-tabset group=\"language\"}\n## tidyverse\n\nFirst, we read in the data:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nexercise <- read_csv(\"data/CS4-exercise.csv\")\n```\n:::\n\n\nYou can visualise the data with:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# visualise the data, sex vs weight\nexercise %>% \n  ggplot(aes(x = sex, y = weight)) +\n  geom_boxplot()\n```\n\n::: {.cell-output-display}\n![](cs4_practical_two-way-anova_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n\n```{.r .cell-code}\n# visualise the data, exercise vs weight\nexercise %>% \n  ggplot(aes(x = exercise, y = weight)) +\n  geom_boxplot()\n```\n\n::: {.cell-output-display}\n![](cs4_practical_two-way-anova_files/figure-html/unnamed-chunk-8-2.png){width=672}\n:::\n:::\n\n\n## R\n\nFirst, we read in the data:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nexercise_r <- read.csv(\"data/CS4-exercise.csv\")\n```\n:::\n\n\n\nYou can visualise the data with:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nboxplot(weight ~ sex, data = exercise_r)\n```\n\n::: {.cell-output-display}\n![](cs4_practical_two-way-anova_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n\n```{.r .cell-code}\nboxplot(weight ~ exercise, data = exercise_r)\n```\n\n::: {.cell-output-display}\n![](cs4_practical_two-way-anova_files/figure-html/unnamed-chunk-10-2.png){width=672}\n:::\n:::\n\n\n## Python\n:::\n\nThese produce box plots showing the response variable (`weight`) only in terms of one of the predictor variables. The values of the other predictor variable in each case aren’t taken into account.\n\nA better way would be to visualise both variables at the same time. We can do this as follows:\n\n::: {.panel-tabset group=\"language\"}\n## tidyverse\n\n::: {.cell}\n\n```{.r .cell-code}\nexercise %>% \n  ggplot(aes(x = sex, y = weight, fill = exercise)) +\n  geom_boxplot() +\n  scale_fill_brewer(palette = \"Dark2\")\n```\n\n::: {.cell-output-display}\n![](cs4_practical_two-way-anova_files/figure-html/unnamed-chunk-11-1.png){width=672}\n:::\n:::\n\n\nThis produces box plots for all (four) combinations of the predictor variables. We are plotting `sex` on the x-axis; `weight` on the y-axis and filling the box plot by `exercise` regime.\n\nHere I've also changed the default colouring scheme, by using `scale_fill_brewer(palette = \"Dark2\")`. This uses a colour-blind friendly colour palette (more about the Brewer colour pallete [here](https://ggplot2.tidyverse.org/reference/scale_brewer.html)).\n\n## R\n\n\n::: {.cell}\n\n```{.r .cell-code}\nboxplot(weight ~ sex + exercise, data = exercise_r)\n```\n\n::: {.cell-output-display}\n![](cs4_practical_two-way-anova_files/figure-html/unnamed-chunk-12-1.png){width=672}\n:::\n:::\n\n\nThis produces box plots for all (four) combinations of the predictor variables. The key argument here is `weight ~ sex + exercise`. This tells R to treat `weight` as a function of both `sex` and `exercise` The + symbol does not mean to add the numbers together, but that `Weight` should be treated as a function of `sex` plus `exercise`\n\nAgain, this is a very basic plot that just shows the raw data and uses default arguments.\n\n\n## Python\n:::\n\nIn this example there are only four box plots and so it is relatively easy to compare them and look for any interactions between variables, but if there were more than two groups per categorical variable, it would become harder to spot what was going on.\n\nTo compare categorical variables more easily we can just plot the group means which aids our ability to look for interactions and the main effects of each predictor variable. This is called an **interaction plot**.\n\nCreate an interaction plot:\n\n::: {.panel-tabset group=\"language\"}\n## tidyverse\n\n\n::: {.cell}\n\n```{.r .cell-code}\nexercise %>% \n  ggplot(aes(x = sex,\n             y = weight,\n             colour = exercise, group = exercise)) +\n  geom_point() +\n  stat_summary(fun = mean, geom = \"point\", size = 3) +\n  stat_summary(fun = mean, geom = \"line\") +\n  scale_colour_brewer(palette = \"Dark2\")\n```\n\n::: {.cell-output-display}\n![](cs4_practical_two-way-anova_files/figure-html/unnamed-chunk-13-1.png){width=672}\n:::\n:::\n\n\nHere we plot `weight` on the y-axis, by `sex` on the x-axis.\n\n* we `colour` the data by `exercise` regime and `group` the data by `exercise` to work out the mean values of each group\n* `geom_point()` displays the data\n* `stat_summary(fun = mean)`calculates the mean for each group\n* `scale_colour_brewer()` lets us define the colour palette\n\nThe choice of which categorical factor is plotted on the horizontal axis and which is plotted as different lines is completely arbitrary. Looking at the data both ways shouldn’t add anything but often you’ll find that you prefer one plot to another.\n\nPlot the interaction plot the other way round:\n\n::: {.cell}\n\n```{.r .cell-code}\nexercise %>% \n  ggplot(aes(x = exercise,\n             y = weight,\n             colour = sex, group = sex)) +\n  geom_point() +\n  stat_summary(fun = mean, geom = \"point\", size = 3) +\n  stat_summary(fun = mean, geom = \"line\") +\n  scale_colour_brewer(palette = \"Dark2\")\n```\n\n::: {.cell-output-display}\n![](cs4_practical_two-way-anova_files/figure-html/unnamed-chunk-14-1.png){width=672}\n:::\n:::\n\n\n## R\n\n\n::: {.cell}\n\n```{.r .cell-code}\ninteraction.plot(exercise_r$sex,\n                 exercise_r$exercise,\n                 exercise_r$weight)\n```\n\n::: {.cell-output-display}\n![](cs4_practical_two-way-anova_files/figure-html/unnamed-chunk-15-1.png){width=672}\n:::\n:::\n\n\nWe've used the `interaction.plot()` function in base R to do this. \n\n* The first argument defines the categorical variable that will be used for the horizontal axis. This must be a factor vector (if it comes from a data.frame then it will automatically be a factor). In this function this is called the `x.factor`.\n* The second argument defines the categorical variable that will be used for the different lines to be plotted. This must be a factor vector. In this function this is called the `trace.factor`.\n* The third argument defines the response variable that will be used for the vertical axis. This must be a numerical vector. In this function this argument is called the `response`.\n\nIt’s common to get the order of these arguments muddled up. Remember that it’s the **third argument** that defines the variable that goes on the vertical axis!\n\nPlot the interaction plot the other way round:\n\n::: {.cell}\n\n```{.r .cell-code}\ninteraction.plot(exercise_r$exercise,\n                 exercise_r$sex,\n                 exercise_r$weight)\n```\n\n::: {.cell-output-display}\n![](cs4_practical_two-way-anova_files/figure-html/unnamed-chunk-16-1.png){width=672}\n:::\n:::\n\n\n## Python\n:::\n\nBy now you should have a good feeling for the data and could already provide some guesses to the following three questions:\n\n* Does there appear to be any interaction between the two categorical variables?\n*\tIf not:\n    * Does `exercise` have an effect on `weight`?\n    * Does `sex` have an effect on `weight`?\n    \nWe can now attempt to answer these three questions more formally using an ANOVA test. We have to test for three things: the interaction, the effect of `exercise` and the effect of `sex.`\n\n## Assumptions\n\nBefore we can formally test these things we first need to define the model and check the underlying assumptions. We use the following code to define the model:\n\n::: {.panel-tabset group=\"language\"}\n## tidyverse\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# define the linear model\nlm_exercise <- lm(weight ~ sex + exercise + sex:exercise,\n                  data = exercise)\n```\n:::\n\n\nThe `sex:exercise` term is how R represents the concept of an interaction between these two variables.\n\n## R\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# define the linear model\nlm_exercise_r <- lm(weight ~ sex + exercise + sex:exercise,\n                  data = exercise_r)\n```\n:::\n\n\nThe `sex:exercise` term is how R represents the concept of an interaction between these two variables.\n\n## Python\n:::\n\nAs the two-way ANOVA is a type of linear model we need to satisfy pretty much the same assumptions as we did for a simple linear regression or a one-way ANOVA:\n\n1. The data must not have any systematic pattern to it\n2. The residuals must be normally distributed\n3. The residuals must have homogeneity of variance\n4. The fit should not depend overly much on a single point (no point should have high leverage).\n\nAgain, we will check these assumptions visually by producing four key diagnostic plots.\n\n::: {.panel-tabset group=\"language\"}\n## tidyverse\n\n::: {.cell}\n\n```{.r .cell-code}\nlm_exercise %>% \n  resid_panel(plots = c(\"resid\", \"qq\", \"ls\", \"cookd\"),\n              smoother = TRUE)\n```\n\n::: {.cell-output-display}\n![](cs4_practical_two-way-anova_files/figure-html/unnamed-chunk-19-1.png){width=672}\n:::\n:::\n\n\n* The Residual plot shows the residuals against the predicted values. There is no systematic pattern here and this plot is pretty good.\n*\tThe Q-Q plot allows a visual inspection of normality. Again, this looks OK (not perfect but OK).\n*\tThe Location-Scale plot allows us to investigate whether there is homogeneity of variance. This plot is fine (not perfect but fine).\n* The Cook's D plot shows that no individual point has a high influence on the model (all values are well below 0.5)\n\n:::note\nThere is a shorthand way of writing:\n\n`weight ~ sex + exercise + sex:exercise`\n\nIf you use the following syntax:\n\n`weight ~ sex * exercise`\n\nThen R interprets it exactly the same way as writing all three terms.\nYou can see this if you compare the output of the following two commands:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nanova(lm(weight ~ sex + exercise + sex:exercise,\n         data = exercise))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nAnalysis of Variance Table\n\nResponse: weight\n             Df Sum Sq Mean Sq F value    Pr(>F)    \nsex           1 607.20  607.20 43.1144 6.493e-06 ***\nexercise      1 184.83  184.83 13.1240  0.002287 ** \nsex:exercise  1  82.42   82.42  5.8521  0.027839 *  \nResiduals    16 225.34   14.08                      \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n:::\n\n```{.r .cell-code}\nanova(lm(weight ~ sex * exercise,\n         data = exercise))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nAnalysis of Variance Table\n\nResponse: weight\n             Df Sum Sq Mean Sq F value    Pr(>F)    \nsex           1 607.20  607.20 43.1144 6.493e-06 ***\nexercise      1 184.83  184.83 13.1240  0.002287 ** \nsex:exercise  1  82.42   82.42  5.8521  0.027839 *  \nResiduals    16 225.34   14.08                      \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n:::\n:::\n\n:::\n\n## R\n\n\n::: {.cell}\n\n```{.r .cell-code}\npar(mfrow = c(2, 2))\n\nplot(lm_exercise_r)\n```\n\n::: {.cell-output-display}\n![](cs4_practical_two-way-anova_files/figure-html/unnamed-chunk-21-1.png){width=672}\n:::\n:::\n\n\n*\tThe first command changes the plotting parameters and splits the graphics window into 2 rows and 2 columns (you won’t notice anything whilst you run it).\n*\tThe second command produces 3 plots in the graphics window and one warning stating that the Residuals vs Factor Levels plot is left out. This is because all of our groups have exactly the same number of data points.\n\n* The top left graph plots the residuals against the fitted values. There is no systematic pattern here and this plot is pretty good.\n*\tThe top right graph allows a visual inspection of normality. Again, this looks OK (not perfect but OK).\n*\tThe bottom left graph allows us to investigate whether there is homogeneity of variance. This plot is fine (not perfect but fine).\n\n:::note\nThere is a shorthand way of writing:\n\n`weight ~ sex + exercise + sex:exercise`\n\nIf you use the following syntax:\n\n`weight ~ sex * exercise`\n\nThen R interprets it exactly the same way as writing all three terms.\nYou can see this if you compare the output of the following two commands:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nanova(lm(weight ~ sex + exercise + sex:exercise,\n         data = exercise_r))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nAnalysis of Variance Table\n\nResponse: weight\n             Df Sum Sq Mean Sq F value    Pr(>F)    \nsex           1 607.20  607.20 43.1144 6.493e-06 ***\nexercise      1 184.83  184.83 13.1240  0.002287 ** \nsex:exercise  1  82.42   82.42  5.8521  0.027839 *  \nResiduals    16 225.34   14.08                      \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n:::\n\n```{.r .cell-code}\nanova(lm(weight ~ sex * exercise,\n         data = exercise_r))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nAnalysis of Variance Table\n\nResponse: weight\n             Df Sum Sq Mean Sq F value    Pr(>F)    \nsex           1 607.20  607.20 43.1144 6.493e-06 ***\nexercise      1 184.83  184.83 13.1240  0.002287 ** \nsex:exercise  1  82.42   82.42  5.8521  0.027839 *  \nResiduals    16 225.34   14.08                      \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n:::\n:::\n\n:::\n\n## Python\n:::\n\n## Implement and interpret test\nThe assumptions appear to be met well enough, meaning we can implement the ANOVA. We do this as follows (this is probably the easiest bit!):\n\n::: {.panel-tabset group=\"language\"}\n## tidyverse\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# perform the ANOVA\nanova(lm_exercise)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nAnalysis of Variance Table\n\nResponse: weight\n             Df Sum Sq Mean Sq F value    Pr(>F)    \nsex           1 607.20  607.20 43.1144 6.493e-06 ***\nexercise      1 184.83  184.83 13.1240  0.002287 ** \nsex:exercise  1  82.42   82.42  5.8521  0.027839 *  \nResiduals    16 225.34   14.08                      \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n:::\n:::\n\n\nWe have a row in the table for each of the different effects that we’ve asked R to consider. The last column is the important one as this contains the p-values (although we will also need the F-values and the degrees of freedom for reporting purposes). We need to look at the interaction row first.\n\n`sex:exercise` has a p-value of about 0.028 (which is smaller than 0.05) and so we can conclude that the interaction between `sex` and `exercise` is significant.\n\n## R\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# perform the ANOVA\nanova(lm_exercise_r)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nAnalysis of Variance Table\n\nResponse: weight\n             Df Sum Sq Mean Sq F value    Pr(>F)    \nsex           1 607.20  607.20 43.1144 6.493e-06 ***\nexercise      1 184.83  184.83 13.1240  0.002287 ** \nsex:exercise  1  82.42   82.42  5.8521  0.027839 *  \nResiduals    16 225.34   14.08                      \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n:::\n:::\n\n\nWe have a row in the table for each of the different effects that we’ve asked R to consider. The last column is the important one as this contains the p-values (although we will also need the F-values and the degrees of freedom for reporting purposes). We need to look at the interaction row first.\n\n`sex:exercise` has a p-value of about 0.028 (which is smaller than 0.05) and so we can conclude that the interaction between `sex` and `exercise` is significant.\n\n## Python\n:::\n\n**This is where we must stop.**\n\nThe top two lines (corresponding to the effects of `sex` and `exercise`) are meaningless now. This is because the interaction means that we cannot interpret the main effects independently.\n\nIn this case, `weight` depends on _and_ the sex _and_ the exercise regime. This means the effect of `sex` on `weight` is dependent on `exercise` (and vice-versa).\n\nWe would report this as follows:\n\n> A two-way ANOVA test showed that there was a significant interaction between the effects of sex and Exercise on Weight (F = 5.8521, df = 1,16, p = 0.028). Exercise was associated with a small loss of weight in males but a larger loss of weight in females.\n\n## Exercise: Cells\n\nCell growth\n\nThese `data/CS4-cells.csv` data are from a fictional experiment that involves looking at the effect of different concentrations of a substance on the growth rate of two different cell types (all annoyingly vague I know – suggestions for context are welcome here!). There are two cell types and three concentrations.\n\nFor each cell type we have a _control_ experiment in which no substance is added (i.e. concentration is `none`); a `low` concentration of substance and a `high` concentration of substance. The cells are called `A` and `B`.\nFor each combination of cell type and substance concentration we add the substance to an individual cell in a petri dish and after 8 hours, we count the number of cells in the dish (again this may well be biologically weird/impossible – suggestions are welcome). Each experiment is repeated three times.\n\nFor each cell type we have a _control_ experiment in which no substance is added (i.e. concentration is `none`); a `low` concentration of substance and a `high` concentration of substance. The cells are called `A` and `B`.\nFor each combination of cell type and substance concentration we add the substance to an individual cell in a petri dish and after 8 hours, we count the number of cells in the dish (Again this may well be biologically weird/impossible – suggestions are welcome). Each experiment is repeated three times.\n\nQuestions to answer:\n\n* Visualise the data using boxplots and interaction plots.\n* Does there appear to be any interaction?\n* Carry out a two-way ANOVA test.\n* Check the assumptions.\n* What can you conclude? (Write a sentence to summarise).\n\n::: {.callout-tip collapse=\"true\"}\n## Answer\n\n::: {.panel-tabset group=\"language\"}\n## tidyverse\n\n### Load the data\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# read in the data\ncells <- read_csv(\"data/CS4-cells.csv\")\n\n# let's have a peek at the data\ncells\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 18 × 4\n      id cell_type concentration cell_number\n   <dbl> <chr>     <chr>               <dbl>\n 1     1 A         none                    7\n 2     2 A         none                    9\n 3     3 A         none                    4\n 4     4 B         none                    5\n 5     5 B         none                    8\n 6     6 B         none                    9\n 7     7 A         low                    22\n 8     8 A         low                    28\n 9     9 A         low                    26\n10    10 B         low                    12\n11    11 B         low                    17\n12    12 B         low                    14\n13    13 A         high                   89\n14    14 A         high                   78\n15    15 A         high                   83\n16    16 B         high                   48\n17    17 B         high                   44\n18    18 B         high                   45\n```\n:::\n:::\n\n\n### Visualise the data\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncells %>% \n  ggplot(aes(x = concentration, y = cell_number)) +\n  geom_boxplot()\n```\n\n::: {.cell-output-display}\n![](cs4_practical_two-way-anova_files/figure-html/unnamed-chunk-26-1.png){width=672}\n:::\n\n```{.r .cell-code}\ncells %>% \n  ggplot(aes(x = cell_type, y = cell_number)) +\n  geom_boxplot()\n```\n\n::: {.cell-output-display}\n![](cs4_practical_two-way-anova_files/figure-html/unnamed-chunk-26-2.png){width=672}\n:::\n:::\n\n\nLet's look at the interaction plots. We're omitting the actual data and just plotting the mean values:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# by cell type\ncells %>% \n  ggplot(aes(x = concentration,\n             y = cell_number,\n             colour = cell_type, group = cell_type)) +\n  stat_summary(fun = mean, geom = \"point\", size = 3) +\n  stat_summary(fun = mean, geom = \"line\") +\n  scale_colour_brewer(palette = \"Dark2\")\n```\n\n::: {.cell-output-display}\n![](cs4_practical_two-way-anova_files/figure-html/unnamed-chunk-27-1.png){width=672}\n:::\n\n```{.r .cell-code}\n# by concentration\ncells %>% \n  ggplot(aes(x = cell_type,\n             y = cell_number,\n             colour = concentration, group = concentration)) +\n  stat_summary(fun = mean, geom = \"point\", size = 3) +\n  stat_summary(fun = mean, geom = \"line\") +\n  scale_colour_brewer(palette = \"Dark2\")\n```\n\n::: {.cell-output-display}\n![](cs4_practical_two-way-anova_files/figure-html/unnamed-chunk-27-2.png){width=672}\n:::\n:::\n\n\nWe're constructed both box plots and we've also constructed two interaction plots. We only needed to do one interaction plot but I find it can be quite useful to look at the data from different angles. Both interaction plots suggest that there is an interaction here as the lines in the plots aren't parallel. Looking at the interaction plot with `concentration` on the x-axis, it appears that there is non-difference between cell types when the concentration is `none`, but that there is a difference between cell types when the concentration is `low` or `high`.\n\n### Assumptions\nFirst we need to define the model:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# define the linear model, with interaction term\nlm_cells <- lm(cell_number ~ concentration * cell_type,\n          data = cells)\n```\n:::\n\n\nNext, we check the assumptions:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlm_cells %>% \n  resid_panel(plots = c(\"resid\", \"qq\", \"ls\", \"cookd\"),\n              smoother = TRUE)\n```\n\n::: {.cell-output-display}\n![](cs4_practical_two-way-anova_files/figure-html/unnamed-chunk-29-1.png){width=672}\n:::\n:::\n\n\nSo, these actually all look pretty good, although at first glance you might be a bit worried by some apparent heterogeneity of variance. The last group in the **Residual plot** does appear to be more spread out then the other 5 groups. This is echoed in the **Location-Scale plot**, where the red line kicks up at the end. Whilst this does technically signify that there is heterogeneity of variance we aren't too worried by this because there are only three data points per group. Because of this low number of data points per group when we get one data point that is a little bit more extreme than the others (purely by chance) then this has a large impact on our perception of the homogeneity of variance. If there were more data points in each group then we would be more certain that any observed heterogeneity of variance was a true feature of the underlying parent population (and therefore a problem) rather than just being caused by a single random point (and therefore not a problem).\n\n### Implement the test\nLet's carry out a two-way ANOVA:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# perform the ANOVA\nanova(lm_cells)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nAnalysis of Variance Table\n\nResponse: cell_number\n                        Df  Sum Sq Mean Sq F value    Pr(>F)    \nconcentration            2 10932.1  5466.1 537.645 1.807e-12 ***\ncell_type                1  1152.0  1152.0 113.311 1.816e-07 ***\nconcentration:cell_type  2  1158.3   579.2  56.967 7.485e-07 ***\nResiduals               12   122.0    10.2                      \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n:::\n:::\n\n\n### Interpret the output and report the results\nThere is definitely a significant interaction between `concentration` and `cell_type`.\n\n## R\n\n### Load the data\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# read in the data\ncells_r <- read.csv(\"data/CS4-cells.csv\")\n\n# let's have a peek at the data\nhead(cells_r)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  id cell_type concentration cell_number\n1  1         A          none           7\n2  2         A          none           9\n3  3         A          none           4\n4  4         B          none           5\n5  5         B          none           8\n6  6         B          none           9\n```\n:::\n:::\n\n\n### Visualise the data\n\n\n::: {.cell}\n\n```{.r .cell-code}\nboxplot(cell_number ~ concentration,\n        data = cells_r)\n```\n\n::: {.cell-output-display}\n![](cs4_practical_two-way-anova_files/figure-html/unnamed-chunk-32-1.png){width=672}\n:::\n\n```{.r .cell-code}\nboxplot(cell_number ~ cell_type,\n        data = cells_r)\n```\n\n::: {.cell-output-display}\n![](cs4_practical_two-way-anova_files/figure-html/unnamed-chunk-32-2.png){width=672}\n:::\n:::\n\n\nLet's look at the interaction plots:\n\n::: {.cell}\n\n```{.r .cell-code}\n# by cell type\ninteraction.plot(cells_r$concentration,\n                 cells_r$cell_type,\n                 cells_r$cell_number)\n```\n\n::: {.cell-output-display}\n![](cs4_practical_two-way-anova_files/figure-html/unnamed-chunk-33-1.png){width=672}\n:::\n\n```{.r .cell-code}\n# by concentration\ninteraction.plot(cells_r$cell_type,\n                 cells_r$concentration,\n                 cells_r$cell_number)\n```\n\n::: {.cell-output-display}\n![](cs4_practical_two-way-anova_files/figure-html/unnamed-chunk-33-2.png){width=672}\n:::\n:::\n\n\nWe're constructed both box plots and we've also constructed two interaction plots. We only needed to do one interaction plot but I find it can be quite useful to look at the data from different angles. Both interaction plots suggest that there is an interaction here as the lines in the plots aren't parallel. Looking at the interaction plot with `concentration` on the x-axis, it appears that there is non-difference between cell types when the concentration is `none`, but that there is a difference between cell types when the concentration is `low` or `high`.\n\n### Assumptions\nFirst we need to define the model:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# define the linear model, with interaction term\nlm_cells_r <- lm(cell_number ~ concentration * cell_type,\n          data = cells_r)\n```\n:::\n\n\nNext, we check the assumptions:\n\n\n::: {.cell}\n\n```{.r .cell-code}\npar(mfrow = c(2, 2))\n\nplot(lm_cells_r)\n```\n\n::: {.cell-output-display}\n![](cs4_practical_two-way-anova_files/figure-html/unnamed-chunk-35-1.png){width=672}\n:::\n:::\n\n\nSo, these actually all look pretty good, although at first glance you might be a bit worried by some apparent heterogeneity of variance. The last group in the `Residuals vs fitted` graph does appear to be more spread out then the other 5 groups. This is echoed in the `Scale-Location` graph, where the red line kicks up at the end. Whilst this does technically signify that there is heterogeneity of variance we aren't too worried by this because there are only three data points per group. Because of this low number of data points per group when we get one data point that is a little bit more extreme than the others (purely by chance) then this has a large impact on our perception of the homogeneity of variance. If there were more data points in each group then we would be more certain that any observed heterogeneity of variance was a true feature of the underlying parent population (and therefore a problem) rather than just being caused by a single random point (and therefore not a problem).\n\n### Implement the test\nLet's carry out a two-way ANOVA:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# perform the ANOVA\nanova(lm_cells_r)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nAnalysis of Variance Table\n\nResponse: cell_number\n                        Df  Sum Sq Mean Sq F value    Pr(>F)    \nconcentration            2 10932.1  5466.1 537.645 1.807e-12 ***\ncell_type                1  1152.0  1152.0 113.311 1.816e-07 ***\nconcentration:cell_type  2  1158.3   579.2  56.967 7.485e-07 ***\nResiduals               12   122.0    10.2                      \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n:::\n:::\n\n\n### Interpret the output and report the results\nThere is definitely a significant interaction between `concentration` and `cell_type`.\n\n## Python\n:::\n:::\n\n## Exercise: Tulips\nBlooms and growing conditions\n\nThe `data/CS4-tulip.csv` data set contains information on an experiment to determine the best conditions for growing tulips (well someone has to care about these sorts of things!). The average number of flower heads (blooms) were recorded for 27 different plots. Each plot experienced one of three different watering regimes and one of three different shade regimes.\n\n* Investigate how the number of blooms is affected by different growing conditions.\n\nNote: have a look at the data and make sure that they are in the correct format!\n\n::: {.callout-tip collapse=\"true\"}\n## Answer\n::: {.panel-tabset group=\"language\"}\n## tidyverse\n\n### Load the data\nIn this data set the watering regime (`water`) and shading regime (`shade`) are encoded with numerical values. However, these numbers are actually categories, representing the amount of water/shade.\n\nAs such, we don't want to treat these as numbers but as _factors_. We can convert the columns using the `as_factor()` function. Because we'd like to keep referring to these columns as factors, we will update our existing data set.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# read in the data\ntulip <- read_csv(\"data/CS4-tulip.csv\")\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nRows: 27 Columns: 3\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\ndbl (3): water, shade, blooms\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n```\n:::\n\n```{.r .cell-code}\n# have a quick look at the data\ntulip\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 27 × 3\n   water shade blooms\n   <dbl> <dbl>  <dbl>\n 1     1     1    0  \n 2     1     2    0  \n 3     1     3  111. \n 4     2     1  183. \n 5     2     2   59.2\n 6     2     3   76.8\n 7     3     1  225. \n 8     3     2   83.8\n 9     3     3  135. \n10     1     1   80.1\n# … with 17 more rows\n```\n:::\n\n```{.r .cell-code}\n# convert watering and shade regimes to factor\ntulip <- tulip %>% \n  mutate(water = as_factor(water),\n         shade = as_factor(shade))\n```\n:::\n\n\nThis dataset has three variables; `blooms` (which is the response variable) and `water` and `shade` (which are the two potential predictor variables). \n\n### Visualise the data\nAs always we'll visualise the data first:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# by watering regime\ntulip %>% \n  ggplot(aes(x = water, y = blooms)) +\n  geom_boxplot()\n```\n\n::: {.cell-output-display}\n![](cs4_practical_two-way-anova_files/figure-html/unnamed-chunk-38-1.png){width=672}\n:::\n\n```{.r .cell-code}\n# by shading regime\ntulip %>% \n  ggplot(aes(x = shade, y = blooms)) +\n  geom_boxplot()\n```\n\n::: {.cell-output-display}\n![](cs4_practical_two-way-anova_files/figure-html/unnamed-chunk-38-2.png){width=672}\n:::\n\n```{.r .cell-code}\n# interaction plot by watering regime\ntulip %>% \n  ggplot(aes(x = shade,\n             y = blooms,\n             colour = water, group = water)) +\n  stat_summary(fun = mean, geom = \"point\", size = 3) +\n  stat_summary(fun = mean, geom = \"line\") +\n  scale_colour_brewer(palette = \"Dark2\")\n```\n\n::: {.cell-output-display}\n![](cs4_practical_two-way-anova_files/figure-html/unnamed-chunk-38-3.png){width=672}\n:::\n\n```{.r .cell-code}\n# interaction plot by shade regime\ntulip %>% \n  ggplot(aes(x = water,\n             y = blooms,\n             colour = shade, group = shade)) +\n  stat_summary(fun = mean, geom = \"point\", size = 3) +\n  stat_summary(fun = mean, geom = \"line\") +\n  scale_colour_brewer(palette = \"Dark2\")\n```\n\n::: {.cell-output-display}\n![](cs4_practical_two-way-anova_files/figure-html/unnamed-chunk-38-4.png){width=672}\n:::\n:::\n\n\nAgain, both interaction plots suggest that there might be an interaction here. Digging in a little deeper from a descriptive perspective, it looks as though that `water` regime 1 is behaving differently to `water` regimes 2 and 3 under different shade conditions.\n\n### Assumptions\nFirst we need to define the model:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# define the linear model\nlm_tulip <- lm(blooms ~ water * shade,\n               data = tulip)\n```\n:::\n\n\nNext, we check the assumptions:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlm_tulip %>% \n  resid_panel(plots = c(\"resid\", \"qq\", \"ls\", \"cookd\"),\n              smoother = TRUE)\n```\n\n::: {.cell-output-display}\n![](cs4_practical_two-way-anova_files/figure-html/unnamed-chunk-40-1.png){width=672}\n:::\n:::\n\n\nThese are actually all OK. Point number 8 is messing with the homogeneity of variance assumption a little bit, but since it's only one point we won't worry about it. A two-way ANOVA analysis is still on the cards.\n\n### Implement the test\nLet's carry out the two-way ANOVA.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# perform the ANOVA\nanova(lm_tulip)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nAnalysis of Variance Table\n\nResponse: blooms\n            Df Sum Sq Mean Sq F value    Pr(>F)    \nwater        2 103626   51813 22.0542 1.442e-05 ***\nshade        2  36376   18188  7.7417   0.00375 ** \nwater:shade  4  41058   10265  4.3691   0.01211 *  \nResiduals   18  42288    2349                      \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n:::\n:::\n\n\n### Interpret the output and report results\nSo we do appear to have a significant interaction between `water` and `shade` as expected.\n\n## R\n\n### Load the data\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# read in the data\ntulip_r <- read.csv(\"data/CS4-tulip.csv\")\n\n# have a quick look at the data\nhead(tulip)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 6 × 3\n  water shade blooms\n  <fct> <fct>  <dbl>\n1 1     1        0  \n2 1     2        0  \n3 1     3      111. \n4 2     1      183. \n5 2     2       59.2\n6 2     3       76.8\n```\n:::\n:::\n\n\nThis data set has three variables; `blooms` (which is the response variable) and `water` and `shade` (which are the two potential predictor variables). \n\n### Visualise the data\nAs always we'll visualise the data first:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nboxplot(blooms ~ water, data = tulip_r)\n```\n\n::: {.cell-output-display}\n![](cs4_practical_two-way-anova_files/figure-html/unnamed-chunk-43-1.png){width=672}\n:::\n\n```{.r .cell-code}\nboxplot(blooms ~ shade, data = tulip_r)\n```\n\n::: {.cell-output-display}\n![](cs4_practical_two-way-anova_files/figure-html/unnamed-chunk-43-2.png){width=672}\n:::\n\n```{.r .cell-code}\ninteraction.plot(tulip_r$water,\n                 tulip_r$shade,\n                 tulip_r$blooms)\n```\n\n::: {.cell-output-display}\n![](cs4_practical_two-way-anova_files/figure-html/unnamed-chunk-43-3.png){width=672}\n:::\n\n```{.r .cell-code}\ninteraction.plot(tulip_r$shade,\n                 tulip_r$water,\n                 tulip_r$blooms)\n```\n\n::: {.cell-output-display}\n![](cs4_practical_two-way-anova_files/figure-html/unnamed-chunk-43-4.png){width=672}\n:::\n:::\n\n\nAgain, both interaction plots suggest that there might be an interaction here. Digging in a little deeper from a descriptive perspective, it looks as though that `water` regime 1 is behaving differently to `water` regimes 2 and 3 under different shade conditions.\n\n### Assumptions\nFirst we need to define the model:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# define the linear model\nlm_tulip_r <- lm(blooms ~ water * shade,\n               data = tulip_r)\n```\n:::\n\n\nNext, we check the assumptions:\n\n\n::: {.cell}\n\n```{.r .cell-code}\npar(mfrow = c(2, 2))\nplot(lm_tulip_r)\n```\n\n::: {.cell-output-display}\n![](cs4_practical_two-way-anova_files/figure-html/unnamed-chunk-45-1.png){width=672}\n:::\n:::\n\n\nThese are actually all OK. Point number 8 is messing with the homogeneity of variance assumption a little bit, but since it's only one point we won't worry about it. A two-way ANOVA analysis is still on the cards.\n\n### Implement the test\nLet's carry out the two-way ANOVA.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# perform the ANOVA\nanova(lm_tulip_r)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nAnalysis of Variance Table\n\nResponse: blooms\n            Df Sum Sq Mean Sq F value    Pr(>F)    \nwater        1 103426  103426  43.057 1.075e-06 ***\nshade        1  31154   31154  12.970  0.001505 ** \nwater:shade  1  33520   33520  13.954  0.001082 ** \nResiduals   23  55248    2402                      \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n:::\n:::\n\n\n### Interpret the output and report results\nSo we do appear to have a significant interaction between `water` and `shade` as expected.\n\n## Python\n:::\n:::\n\n## Key points\n\n::: callout-note\n- A two-way ANOVA is used when there are two categorical variables and a single continuous variable\n- We can visually check for interactions between the categorical variables by using interaction plots\n- The two-way ANOVA is a type of linear model and assumes the following:\n    1. the data have no systematic pattern\n    2. the residuals are normally distributed\n    3. the residuals have homogeneity of variance\n    4. the fit does not depend on a single point (no single point has high leverage)\n:::\n",
    "supporting": [
      "cs4_practical_two-way-anova_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}